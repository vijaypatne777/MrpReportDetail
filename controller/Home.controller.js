sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageToast","sap/ui/table/library","sap/ui/core/format/DateFormat","sap/ui/model/Sorter","sap/m/Token","sap/ui/model/type/String","sap/ui/model/json/JSONModel","sap/m/ColumnListItem","sap/m/Label","sap/ui/core/util/Export","sap/m/MessageBox","sap/ui/core/util/ExportTypeCSV"],function(e,t,a,r,l,i,n,s,o,u,d,p,m){"use strict";var P=a.SortOrder;var M="/OPENSAP/sap/opu/odata/sap/API_MRP_MATERIALS_SRV_01";var R={};var v={items:[]};var y={MatList:[]};var v={BotList:[]};var f={oBotList:[]};var S;return e.extend("PP.mrpReport.controller.Home",{onInit:function(){var e=this.getView();var t=e.byId("multiInput2");t.addValidator(function(e){var t=e.text;return new i({key:t,text:t})})},onSubmitInput:function(e){var t=e.getParameters().value.toUpperCase();if(t!==""){var a=this.getView();var r=a.byId("multiInput2");var l={items:[]};var i="/OPENSAP/sap/opu/odata/sap/API_MRP_MATERIALS_SRV_01";var n=new sap.ui.model.odata.ODataModel(i,true);var s=this.getView().byId("idFieldPlant").getValue().toUpperCase();var o=this.getView().byId("idFieldMRPArea").getValue().toUpperCase();var u=[];u.push(new sap.ui.model.Filter("Material",sap.ui.model.FilterOperator.EQ,t));var d=new sap.ui.model.Filter({filters:u,or:true,_bMultiFilter:false});var p=new sap.ui.model.Filter("MRPPlant",sap.ui.model.FilterOperator.EQ,s);var m=new sap.ui.model.Filter({filters:[p],and:true});var P=new sap.ui.model.Filter("MRPArea",sap.ui.model.FilterOperator.EQ,o);var M=new sap.ui.model.Filter({filters:[P],and:true});var R=new Array(new sap.ui.model.Filter({filters:[m,M,d],and:true}));n.read("/A_MRPMaterial",{async:false,filters:[R],success:function(e,a){var r=e.results;var i=r.length;if(i!==0){for(var n=0;n<i;n++){l.items.push({Material:r[n].Material,MaterialName:r[n].MaterialName})}}else{S=null;l=null;sap.m.MessageToast.show("No value found for material   "+t+".Please delete.");t=null}}})}},onDataExport:function(e){var t=new sap.ui.model.json.JSONModel;t.setData(v.BotList);var a=new d({exportType:new sap.ui.core.util.ExportTypeCSV({separatorChar:",",charset:"utf-8"}),models:t,rows:{path:"/"},columns:[{name:"Material",template:{content:"{Material}"}},{name:"MRPPlant",template:{content:"{MRPPlant}"}},{name:"MRPArea",template:{content:"{MRPArea}"}},{name:"MaterialName",template:{content:"{MaterialName}"}},{name:"Supplier",template:{content:"{MRPElementBusinessPartner}"}},{name:"End Date",template:{content:"{MRPElementAvailyOrRqmtDate}"}},{name:"Availablity",template:{content:"{MRPAvailableQuantity}"}},{name:"Availablity Date",template:{content:"{MRPAvailableQuantityDate}"}},{name:"SafetyStk",template:{content:"{SafetyStk}"}},{name:"Stock",template:{content:"{Stock}"}},{name:"AvailableStock",template:{content:"{AvailableStock}"}},{name:"DependReq",template:{content:"{DependReq}"}},{name:"PurchReq",template:{content:"{PurchReq}"}},{name:"DependReq",template:{content:"{DependReq}"}},{name:"Plndorder",template:{content:"{Plndorder}"}},{name:"IndReqmt",template:{content:"{IndReqmt}"}},{name:"Order",template:{content:"{Order}"}},{name:"ProdOrder",template:{content:"{ProdOrder}"}},{name:"Delivery",template:{content:"{Delivery}"}},{name:"POitem",template:{content:"{POitem}"}},{name:"OrderRes",template:{content:"{OrderRes}"}},{name:"RetrnsItem",template:{content:"{RetrnsItem}"}}]});a.saveFile().always(function(){this.destroy()})},onHelpTable:function(e){debugger;sap.m.MessageToast.show("Please wait !!! fetching list of Material for you ");var t=this.getView().byId("idFieldPlant").getValue().toUpperCase();var a=this.getView().byId("idFieldMRPArea").getValue().toUpperCase();if(t!==""||a!==""){var r={items:[]};if(!this.tableDialog){this.tableDialog=sap.ui.xmlfragment("PP.mrpReport.fragments.ValueHelpPopup",this);this.getView().addDependent(this.tableDialog);jQuery.sap.syncStyleClass("sapUiSizeCompact",this.getView(),this.tableDialog)}this.tableDialog.open();var l=sap.ui.getCore().byId("botTabDialog");l.getColumns()[0].setProperty("visible",true);var i=new sap.ui.model.json.JSONModel;i.setData(r);var n="/OPENSAP/sap/opu/odata/sap/API_PRODUCT_SRV";var s=new sap.ui.model.odata.ODataModel(n,true);var o="A_ProductPlant";debugger;var u=this.getView().byId("idMRPControl").getValue().toUpperCase();this.tableDialog.setBusy(true);if(u===""){var d="/A_ProductPlant?$orderby=Product&$select=Product,Plant,MRPType&$filter=( Plant eq '"+t+"')"}if(u!==""){var d="/A_ProductPlant?$orderby=Product&$select=Product,Plant,MRPType&$filter=( Plant eq '"+t+"')"}var p=this.getView().byId("idMRPType").getValue().toUpperCase();if(p!==""){var d="/A_ProductPlant?$orderby=Product&$select=Product,Plant,MRPType&$filter=( Plant eq '"+t+"' and MRPType eq '"+p+"')"}sap.ui.core.BusyIndicator.show();s.read(d,{success:function(e,t){var a=e.results;var n=a.length;if(n!==0){for(var s=0;s<n;s++){r.items.push({Material:a[s].Product})}sap.ui.core.BusyIndicator.hide()}else{r=null;sap.m.MessageToast.show("The Search Criteria fetched no result. Please enter valid values")}i.setData(r);f=r;l.setModel(i,"botTabModel3");l.setVisible(true)}})}else{sap.m.MessageToast.show("Please provide MRP Area and Plant")}this.tableDialog.setBusy(false)},onConfirm:function(e){var t={MatList:[]};var a=sap.ui.getCore().byId("botTabDialog");var r=a.getModel("botTabModel3");var l=a.getSelectedItems();var i=l.length;var n=this.getView();var s=n.byId("multiInput2");for(var o=0;o<i;o++){var u=a.getSelectedItems()[o].oBindingContexts.botTabModel3.sPath;var d=a.getSelectedItems()[o].oBindingContexts.botTabModel3.sPath.slice(7,15);var p=r.oData.items[d].Material;var m=r.oData.items[d].MaterialName;s.addToken(new sap.m.Token({key:p,text:p}));t.MatList.push({Material:p,MaterialName:m})}var P=s.getTokens();i=P.length;s.removeAllTokens();for(var o=0;o<i;o++){if(o>0){var M=o-1;if(P[M].mProperties.key===P[o].mProperties.key){break}}s.addToken(new sap.m.Token({key:P[o].mProperties.key,text:P[o].mProperties.key}))}this.tableDialog.close()},onCancel:function(){this.tableDialog.close()},onSuggestLive:function(e){var t={items:[]};var a="/OPENSAP/sap/opu/odata/sap/API_PRODUCT_SRV";var r=new sap.ui.model.odata.ODataModel(a,true);var l="A_ProductPlant";var i=this.getView();var n=i.byId("multiInput2");var s=this.getView().byId("idFieldPlant").getValue().toUpperCase();var o=this.getView().byId("idFieldMRPArea").getValue().toUpperCase();var u=[];u.push(new sap.ui.model.Filter("Product",sap.ui.model.FilterOperator.EQ,e.mParameters.query.toUpperCase()));var d=new sap.ui.model.Filter({filters:u,or:true,_bMultiFilter:false});var p=new sap.ui.model.Filter("Plant",sap.ui.model.FilterOperator.EQ,s);var m=new sap.ui.model.Filter({filters:[p],and:true});var P=new Array(new sap.ui.model.Filter({filters:[m,d],and:true}));r.read("/A_ProductPlant",{async:false,filters:[P],success:function(e,a){var r=e.results;var l=r.length;if(l!==0){for(var i=0;i<l;i++){t.items.push({Material:r[i].Product})}}else{t=null;sap.m.MessageToast.show("The Search Criteria fetched no result. Please enter valid values")}}});var M=e.getParameter("suggestValue");var R=new sap.ui.model.json.JSONModel;var i=this.getView();var n=i.byId("multiInput2");var v=n.getValue();n.setValue="";R.setData(t);var y=n._getTokensList().getItems();var f=n._getTokensList().getItems().length;debugger;for(var S=0;S<t.items.length;S++){for(var c=0;c<f;c++){if(t.items[S].Material!==n._getTokensList().getItems()[c].mProperties.title){n.addToken(new sap.m.Token({key:t.items[S].Material,text:t.items[S].Material}))}}}if(y.length===0){for(var S=0;S<t.items.length;S++){n.addToken(new sap.m.Token({key:t.items[S].Material,text:t.items[S].Material}))}}i.setModel(R,"botModelSugg");this.oSF=sap.ui.getCore().byId("searchField");this.oSF.suggest()},_validateMaterial:function(){var e=this.getView().byId("idMRPControl").getValue().toUpperCase();var t=this.getView().byId("idFieldPlant").getValue().toUpperCase();var a=this.getView().byId("idFieldMRPArea").getValue().toUpperCase();var r=this.getView();var l=r.byId("multiInput2");var i=l.getTokens();var n={items:[]};var s="/OPENSAP/sap/opu/odata/sap/API_MRP_MATERIALS_SRV_01";var o=new sap.ui.model.odata.ODataModel(s,true);var u=[];for(var d=0;d<i.length;d++){u.push(new sap.ui.model.Filter("Material",sap.ui.model.FilterOperator.EQ,i[d].mProperties.key.toUpperCase()))}var p=new sap.ui.model.Filter({filters:u,or:true,_bMultiFilter:false});var m=new sap.ui.model.Filter("MRPPlant",sap.ui.model.FilterOperator.EQ,t);var P=new sap.ui.model.Filter({filters:[m],and:true});var M=new sap.ui.model.Filter("MRPArea",sap.ui.model.FilterOperator.EQ,a);var R=new sap.ui.model.Filter({filters:[M],and:true});var v=new Array(new sap.ui.model.Filter({filters:[P,R,p],and:true}));o.read("/A_MRPMaterial",{async:false,filters:[v],success:function(e,t){var a=e.results;var r=a.length;if(r!==0){for(var l=0;l<r;l++){n.items.push({Material:a[l].Material,MaterialName:a[l].MaterialName})}}}});return n.items},onSearch:function(e){var t=this.getView().byId("idMRPControl").getValue().toUpperCase();var a=this.getView().byId("idFieldPlant").getValue().toUpperCase();var r=this.getView().byId("idFieldMRPArea").getValue().toUpperCase();var l=this.getView();var i=l.byId("multiInput2");var n=i.getTokens();var s={items:[]};s.items=this._validateMaterial();if(a!==""||r!==""||n.length>0){var o=[];for(var u=0;u<n.length;u++){o.push(new sap.ui.model.Filter("Material",sap.ui.model.FilterOperator.EQ,i.getTokens()[u].mProperties.key.toUpperCase()))}var d=new sap.ui.model.Filter({filters:o,or:true,_bMultiFilter:false});var p=new sap.ui.model.Filter("MRPPlant",sap.ui.model.FilterOperator.EQ,a);var m=new sap.ui.model.Filter({filters:[p],and:true});var P=new sap.ui.model.Filter("MRPArea",sap.ui.model.FilterOperator.EQ,r);var M=new sap.ui.model.Filter({filters:[P],and:true});var R=new Array(new sap.ui.model.Filter({filters:[m,M,d],and:true}));debugger;if(t!==""){var y=new sap.ui.model.Filter("MRPController",sap.ui.model.FilterOperator.EQ,t);var f=new sap.ui.model.Filter({filters:[y],and:true});var R=new Array(new sap.ui.model.Filter({filters:[m,M,d,f],and:true}))}var S="/OPENSAP/sap/opu/odata/sap/API_MRP_MATERIALS_SRV_01";var c="/SupplyDemandItems";var g=new sap.ui.model.odata.ODataModel(S,true);g.setHeaders({"Content-Type":"application/json",Accept:"application/json",APIKey:"jQdx3TI7jIFCKaxK3GR4r5dYqF8heA4q"});var b={};var O=[];var F={};var h=[];g.read(c,{async:false,filters:[R],success:function(e,t){var a=e.results;var r=a.length;var l=0;debugger;var i;for(var n=0;n<r;n++){l++;if(a[n].MRPAvailableQuantity>0&&a[n].MRPElementCategoryShortName!=="SafetyStk"&&i!=="true"){b.MRPAvailableQuantity=parseFloat(a[n].MRPAvailableQuantity);b.MRPAvailableQuantityDate=a[n].MRPElementAvailyOrRqmtDate.toISOString();i="true"}if(l===r){if(a[n].MRPElementCategoryShortName==="SafetyStk"){var s=parseFloat(a[n].MRPElementOpenQuantity);b.Material=a[n].Material;b.SafetyStk=parseFloat(b.SafetyStk)+s;if(b.SafetyStk===undefined){b.SafetyStk=0}if(b.SafetyStk!==0){b.SafetyStk*=-1}O.push(b);i="false";s=0;b={}}else{b.Material=a[n].Material;b.SafetyStk=s;if(b.SafetyStk===undefined){b.SafetyStk=0}if(b.SafetyStk!==0){b.SafetyStk*=-1}O.push(b);i="false";s=0;b={}}}else{if(a[n].Material===a[n+1].Material){if(a[n].MRPElementCategoryShortName==="SafetyStk"){var s=parseFloat(a[n].MRPElementOpenQuantity);b.Material=a[n].Material;b.SafetyStk=parseFloat(b.SafetyStk)+s}}else{if(a[n].MRPElementCategoryShortName==="SafetyStk"){var s=parseFloat(a[n].MRPElementOpenQuantity);b.Material=a[n].Material;b.SafetyStk=parseFloat(b.SafetyStk)+s;if(b.SafetyStk===undefined){b.SafetyStk=0}if(b.SafetyStk!==0){b.SafetyStk*=-1}O.push(b);i="false";s=0;b={}}else{b.Material=a[n].Material;b.SafetyStk=s;if(b.SafetyStk===undefined){b.SafetyStk=0}if(b.SafetyStk!==0){b.SafetyStk*=-1}O.push(b);i="false";s=0;b={}}}}F.Material=a[n].Material;F.MRPPlant=a[n].MRPPlant;F.MRPArea=a[n].MRPArea;F.MRPController=a[n].MRPController;F.MRPElementCategoryShortName=a[n].MRPElementCategoryShortName;F.MRPElementOpenQuantity=a[n].MRPElementOpenQuantity;F.MRPElementAvailyOrRqmtDate=new Date(a[n].MRPElementAvailyOrRqmtDate);F.MaterialBaseUnit=a[n].MaterialBaseUnit;F.MRPElementBusinessPartner=a[n].MRPElementBusinessPartner;h.push(F);F={}}}});var k={};var A=[];var E=h.length;var D=this.getView().byId("idDRS3");if(D.getValue()!==""){for(var Q=0;Q<E;Q++){if(h[Q].MRPElementAvailyOrRqmtDate.toISOString()>=D.getFrom().toISOString()&&h[Q].MRPElementAvailyOrRqmtDate.toISOString()<=D.getTo().toISOString()){for(var I=0;I<s.items.length;I++){if(h[Q].Material===s.items[I].Material){k.MaterialName=s.items[I].MaterialName;break}}for(var w=0;w<O.length;w++){if(h[Q].Material===O[w].Material){k.SafetyStk=O[w].SafetyStk;k.MRPAvailableQuantity=O[w].MRPAvailableQuantity;k.MRPAvailableQuantityDate=O[w].MRPAvailableQuantityDate;break}}k.Material=h[Q].Material;k.MRPPlant=h[Q].MRPPlant;k.MRPArea=h[Q].MRPArea;k.MRPController=h[Q].MRPController;k.MaterialBaseUnit=h[Q].MaterialBaseUnit;k.MRPElementAvailyOrRqmtDate=h[Q].MRPElementAvailyOrRqmtDate;k.MRPElementCategoryShortName=h[Q].MRPElementCategoryShortName;k.MRPElementOpenQuantity=h[Q].MRPElementOpenQuantity;k.MRPElementBusinessPartner=h[Q].MRPElementBusinessPartner;A.push(k);k={}}}}else{for(var Q=0;Q<E;Q++){for(var I=0;I<s.items.length;I++){if(h[Q].Material===s.items[I].Material){k.MaterialName=s.items[I].MaterialName;break}}for(var w=0;w<O.length;w++){if(h[Q].Material===O[w].Material){k.SafetyStk=O[w].SafetyStk;k.MRPAvailableQuantity=O[w].MRPAvailableQuantity;k.MRPAvailableQuantityDate=O[w].MRPAvailableQuantityDate;break}}k.Material=h[Q].Material;k.MRPPlant=h[Q].MRPPlant;k.MRPArea=h[Q].MRPArea;k.MRPController=h[Q].MRPController;k.MaterialBaseUnit=h[Q].MaterialBaseUnit;k.MRPElementAvailyOrRqmtDate=h[Q].MRPElementAvailyOrRqmtDate;k.MRPElementCategoryShortName=h[Q].MRPElementCategoryShortName;k.MRPElementOpenQuantity=h[Q].MRPElementOpenQuantity;k.MRPElementBusinessPartner=h[Q].MRPElementBusinessPartner;A.push(k);k={}}}var C=[];C=A;var q=0;var k={};var T=[];k.Stock=0;k.SafetyStk=0;k.AvailableStock=0;k.DependReq=0;k.PurchReq=0;for(var Q=0;Q<C.length;Q++){q++;if(q===C.length){var V="X";var N=C[Q].MRPElementCategoryShortName;var _=N.trim();switch(_){case"Stock":if(k.Stock===undefined){k.Stock=parseFloat(C[Q].MRPElementOpenQuantity)}else{k.Stock=parseFloat(k.Stock)+parseFloat(C[Q].MRPElementOpenQuantity)}break;case"DependReq":if(k.DependReq===undefined){k.DependReq=parseFloat(C[Q].MRPElementOpenQuantity)}else{k.DependReq=parseFloat(k.DependReq)+parseFloat(C[Q].MRPElementOpenQuantity)}break;case"PurchReq":if(k.PurchReq===undefined){k.PurchReq=parseFloat(C[Q].MRPElementOpenQuantity)}else{k.PurchReq=parseFloat(k.PurchReq)+parseFloat(C[Q].MRPElementOpenQuantity)}break;case"Plnd order":if(k.Plndorder===undefined){k.Plndorder=parseFloat(C[Q].MRPElementOpenQuantity)}else{k.Plndorder=parseFloat(k.Plndorder)+parseFloat(C[Q].MRPElementOpenQuantity)}break;case"IndReqmt":if(k.IndReqmt===undefined){k.IndReqmt=parseFloat(C[Q].MRPElementOpenQuantity)}else{k.IndReqmt=parseFloat(k.IndReqmt)+parseFloat(C[Q].MRPElementOpenQuantity)}break;case"Order":if(k.Order===undefined){k.Order=parseFloat(C[Q].MRPElementOpenQuantity)}else{k.Order=parseFloat(k.Order)+parseFloat(C[Q].MRPElementOpenQuantity)}break;case"ProdOrder":if(k.ProdOrder===undefined){k.ProdOrder=parseFloat(C[Q].MRPElementOpenQuantity)}else{k.ProdOrder=parseFloat(k.ProdOrder)+parseFloat(C[Q].MRPElementOpenQuantity)}break;case"Delivery":if(k.Delivery===undefined){k.Delivery=parseFloat(C[Q].MRPElementOpenQuantity)}else{k.Delivery=parseFloat(k.Delivery)+parseFloat(C[Q].MRPElementOpenQuantity)}break;case"PO item":if(k.POitem===undefined){k.POitem=parseFloat(C[Q].MRPElementOpenQuantity)}else{k.POitem=parseFloat(k.POitem)+parseFloat(C[Q].MRPElementOpenQuantity)}k.MRPElementBusinessPartner=C[Q].MRPElementBusinessPartner;break;case"OrderRes":if(k.OrderRes===undefined){k.OrderRes=parseFloat(C[Q].MRPElementOpenQuantity)}else{k.OrderRes=parseFloat(k.OrderRes)+parseFloat(C[Q].MRPElementOpenQuantity)}break;case"RetrnsItem":if(k.RetrnsItem===undefined){k.RetrnsItem=parseFloat(C[Q].MRPElementOpenQuantity)}else{k.RetrnsItem=parseFloat(k.RetrnsItem)+parseFloat(C[Q].MRPElementOpenQuantity)}break}k.SafetyStk=parseFloat(C[Q].SafetyStk);k.AvailableStock=parseFloat(k.Stock)-parseFloat(k.SafetyStk);if(k.AvailableStock===undefined||k.AvailableStock==="NaN"){k.AvailableStock=0}if(k.AvailableStock<0){k.status="Warning"}var B=new Date(C[Q].MRPElementAvailyOrRqmtDate);var U=B.toISOString();k.MRPElementAvailyOrRqmtDate=U.substr(0,10);k.Material=C[Q].Material;k.MRPPlant=C[Q].MRPPlant;k.MRPArea=C[Q].MRPArea;k.MRPController=C[Q].MRPController;k.MRPAvailableQuantity=C[Q].MRPAvailableQuantity;if(C[Q].MRPAvailableQuantityDate!==undefined){k.MRPAvailableQuantityDate=C[Q].MRPAvailableQuantityDate.substr(0,10)}k.MaterialBaseUnit=C[Q].MaterialBaseUnit;k.MRPElementOpenQuantity=C[Q].MRPElementOpenQuantity;k.MaterialName=C[Q].MaterialName;T.push(k);k={}}else{if(C[Q].Material===C[Q+1].Material){N=C[Q].MRPElementCategoryShortName;_=N.trim();switch(_){case"Stock":if(k.Stock===undefined){k.Stock=parseFloat(C[Q].MRPElementOpenQuantity)}else{k.Stock=parseFloat(k.Stock)+parseFloat(C[Q].MRPElementOpenQuantity)}break;case"DependReq":if(k.DependReq===undefined){k.DependReq=parseFloat(C[Q].MRPElementOpenQuantity)}else{k.DependReq=parseFloat(k.DependReq)+parseFloat(C[Q].MRPElementOpenQuantity)}break;case"PurchReq":if(k.PurchReq===undefined){k.PurchReq=parseFloat(C[Q].MRPElementOpenQuantity)}else{k.PurchReq=parseFloat(k.PurchReq)+parseFloat(C[Q].MRPElementOpenQuantity)}break;case"Plnd order":if(k.Plndorder===undefined){k.Plndorder=parseFloat(C[Q].MRPElementOpenQuantity)}else{k.Plndorder=parseFloat(k.Plndorder)+parseFloat(C[Q].MRPElementOpenQuantity)}break;case"IndReqmt":if(k.IndReqmt===undefined){k.IndReqmt=parseFloat(C[Q].MRPElementOpenQuantity)}else{k.IndReqmt=parseFloat(k.IndReqmt)+parseFloat(C[Q].MRPElementOpenQuantity)}break;case"Order":if(k.Order===undefined){k.Order=parseFloat(C[Q].MRPElementOpenQuantity)}else{k.Order=parseFloat(k.Order)+parseFloat(C[Q].MRPElementOpenQuantity)}break;case"ProdOrder":if(k.ProdOrder===undefined){k.ProdOrder=parseFloat(C[Q].MRPElementOpenQuantity)}else{k.ProdOrder=parseFloat(k.ProdOrder)+parseFloat(C[Q].MRPElementOpenQuantity)}break;case"Delivery":if(k.Delivery===undefined){k.Delivery=parseFloat(C[Q].MRPElementOpenQuantity)}else{k.Delivery=parseFloat(k.Delivery)+parseFloat(C[Q].MRPElementOpenQuantity)}break;case"PO item":if(k.POitem===undefined){k.POitem=parseFloat(C[Q].MRPElementOpenQuantity)}else{k.POitem=parseFloat(k.POitem)+parseFloat(C[Q].MRPElementOpenQuantity)}k.MRPElementBusinessPartner=C[Q].MRPElementBusinessPartner;break;case"OrderRes":if(k.OrderRes===undefined){k.OrderRes=parseFloat(C[Q].MRPElementOpenQuantity)}else{k.OrderRes=parseFloat(k.OrderRes)+parseFloat(C[Q].MRPElementOpenQuantity)}break;case"RetrnsItem":if(k.RetrnsItem===undefined){k.RetrnsItem=parseFloat(C[Q].MRPElementOpenQuantity)}else{k.RetrnsItem=parseFloat(k.RetrnsItem)+parseFloat(C[Q].MRPElementOpenQuantity)}break}}if(V==="X"){if(k.SafetyStk===undefined){k.SafetyStk=0}k.SafetyStk=parseFloat(C[Q].SafetyStk);k.AvailableStock=parseFloat(k.Stock)-parseFloat(k.SafetyStk);if(k.AvailableStock===undefined||k.AvailableStock==="NaN"){k.AvailableStock=0}if(k.AvailableStock<0){k.status="Warning"}var B=new Date(C[Q].MRPElementAvailyOrRqmtDate);var U=B.toISOString();k.MRPElementAvailyOrRqmtDate=U.substr(0,10);k.Material=C[Q].Material;k.MRPPlant=C[Q].MRPPlant;k.MRPArea=C[Q].MRPArea;k.MRPController=C[Q].MRPController;k.MRPAvailableQuantity=C[Q].MRPAvailableQuantity;if(C[Q].MRPAvailableQuantityDate!==undefined){k.MRPAvailableQuantityDate=C[Q].MRPAvailableQuantityDate.substr(0,10)}k.MaterialBaseUnit=C[Q].MaterialBaseUnit;k.MRPElementOpenQuantity=C[Q].MRPElementOpenQuantity;k.MaterialName=C[Q].MaterialName;T.push(k);k={}}else{if(C[Q].Material!==C[Q+1].Material){if(k.SafetyStk===undefined){k.SafetyStk=0}k.SafetyStk=parseFloat(C[Q].SafetyStk);k.AvailableStock=parseFloat(k.Stock)-parseFloat(k.SafetyStk);if(k.AvailableStock===undefined||k.AvailableStock==="NaN"){k.AvailableStock=0}if(k.AvailableStock<0){k.status="Warning"}var B=new Date(C[Q].MRPElementAvailyOrRqmtDate);var U=B.toISOString();k.MRPElementAvailyOrRqmtDate=U.substr(0,10);k.Material=C[Q].Material;k.MRPPlant=C[Q].MRPPlant;k.MRPArea=C[Q].MRPArea;k.MRPController=C[Q].MRPController;k.MRPAvailableQuantity=C[Q].MRPAvailableQuantity;if(C[Q].MRPAvailableQuantityDate!==undefined){k.MRPAvailableQuantityDate=C[Q].MRPAvailableQuantityDate.substr(0,10)}k.MaterialBaseUnit=C[Q].MaterialBaseUnit;k.MRPElementOpenQuantity=C[Q].MRPElementOpenQuantity;k.MaterialName=C[Q].MaterialName;T.push(k);k={}}}}}v.BotList=T;var x=new sap.ui.model.json.JSONModel;var L=sap.ui.getCore().byId("container-mrpReport---Home--idTable");x.setData(v);L.setModel(x,"botTabModel");L.setVisible(true)}else{sap.m.MessageToast.show("Please provide Material Number, MRP Area and Plant value")}},sortCategories:function(e){var t=this.getView();var a=sap.ui.getCore().byId("container-mrpReport---Home--idTable");var r=t.byId("Material");a.sort(r,this._bSortColumnDescending?P.Descending:P.Ascending,true);this._bSortColumnDescending=!this._bSortColumnDescending},sortCategoriesAndName:function(e){var t=this.getView();var a=sap.ui.getCore().byId("container-mrpReport---Home--idTable");a.sort(t.byId("Material"),P.Ascending,false);a.sort(t.byId("MRPPlant"),P.Ascending,true)},sortDeliveryDate:function(e){var t=e.getParameter("column");var a=this.byId("deliverydate");if(t!=a){a.setSorted(false);return}e.preventDefault();var i=e.getParameter("sortOrder");var n=r.getDateInstance({pattern:"dd/MM/yyyy"});this._resetSortingState();a.setSorted(true);a.setSortOrder(i);var s=new l(a.getSortProperty(),i===P.Descending);s.fnCompare=function(e,t){if(t==null){return-1}if(e==null){return 1}var a=n.parse(e).getTime();var r=n.parse(t).getTime();if(a<r){return-1}if(a>r){return 1}return 0};this.byId("idTable").getBinding("rows").sort(s)},_resetSortingState:function(){var e=sap.ui.getCore().byId("container-mrpReport---Home--idTable");var t=e.getColumns();for(var a=0;a<t.length;a++){t[a].setSorted(false)}}})});